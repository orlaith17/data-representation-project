<!DOCTYPE html>
<html>
    <head>
        <title>Stock</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
       <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script> -->
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
       
       <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

       <style>
       .jumbotron {
         background-image: url("img/header.png");
         background-size: auto 100%; 
         background-position: right bottom;
         background-repeat: no-repeat;
        }
        </style>
    
  
  </head>

    <body>
        <!--//navbar-->
        <div class="container">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
              
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page"  href="index.html">Home</a>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link" href="members.html">Members</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="stock.html">Stock</a>
                  </li>
              
                </ul>

                <ul class="navbar-nav ml-auto" >

               
                  <li class="nav-item">
                    <a class="nav-link" href="/admin">Login</a>
                  </li>

                </ul>
              </div>
            </div>
          </nav>
        </div>


<!--//jumbotron-->
<div class="container">  
  
    <div class="jumbotron">
			<div class="b" >
				
				</div>

  </div>

  <div class="container text-center">

  </div>
           

</div>  

<!--//link to on update table-->
<div class ="container" id="create-update" style="display:none">
  <h2>create-update</h2>
            <table id ="createUpdateForm">
                <tr>
                    <td>Item</td>
                    <td><input type="text" name="Item"></td>
                </tr>
                <tr>
                    <td>Description</td>
                    <td><input type="text" name="Description"></td>     
                </tr>
                <tr>           
                    <td>Price</td>
                    <td><input type="text" name="Price"></td> 
                </tr>
                
                <tr>
                    <td></td><td><button id="create-update-button" onclick="createStock()">Create</button></td>
                </tr>
            </table>
</div>

<!--//stock table-->
<div class="container" id="display">

  <h1>Stock</h1>
  <button  onclick="showCreate()">Create</button>

            <table class="table" id="stockTable">
                <tr>
                        <th>ID</th>
                        <th>Item</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Update</th>
                        <th>Delete</th>
                        
                </tr>                
            </table>



</div>


  

<script>
// turn on and off show create table
  function showCreate(){
    document.getElementById('display').style.display ="none"
    document.getElementById('create-update').style.display = "block"
  }
  function showDisplay(){
    document.getElementById('display').style.display="block"
    document.getElementById('create-update').style.display="none"
  }

// do something here
  function createStock(stock){
    console.log("in doCreate")
    stock = getStockFromForm()
   $.ajax({
      url:'/stock',
      method:'POST',
      data: stock,
      dataType:'JSON',
      success:function(results){
        console.log(results)
        addStockToTable(stock)
        showDisplay()
      },
      error:function(xhr,status,error){
          console.log ("error"+error+"code:"+status)
      }
    })

  
            }

  function getStockFromForm(){
    var form = document.getElementById('createUpdateForm')
    var stock = {}
    stock.name = form.querySelector('input[name="Item"]').value
    stock.description = form.querySelector('input[name="Description"]').value
    stock.price = form.querySelector('input[name="Price"]').value
    console.log(JSON.stringify(stock))
    return stock 

            }

//ajax to populate table
  function populateTable(){
      $.ajax({
      url: 'http://127.0.0.1:5000/stock',
      method: "GET",
      dataType: "JSON",
      success: function (results) {
          for(stock of results){
              addStockToTable(stock)
          }
      },
      error:function(xhr,status,error){
          console.log ("error"+error+"code:"+status)
      }
      })
  }

// add stock to to columns
  function addStockToTable(stock){
      tableElem = document.getElementById('stockTable')
      rowElem = tableElem.insertRow(-1)
      rowElem.setAttribute("id", stock.stockId)
      cell1=rowElem.insertCell(0)                
      cell1.innerHTML=stock.stockId
      cell2=rowElem.insertCell(1)                
      cell2.innerHTML=stock.name
      cell3=rowElem.insertCell(2)                
      cell3.innerHTML=stock.description            
      cell4=rowElem.insertCell(3)                
      cell4.innerHTML=stock.price
      cell5=rowElem.insertCell(4)                
      cell5.innerHTML='<button onclick="showUpdate(this)">Update</button>'
      cell6=rowElem.insertCell(5)                
      cell6.innerHTML='<button onclick="deletes(this)">Delete</button>'
  }
  populateTable()



</script>

</body>
</html>